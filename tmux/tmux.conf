##### =========================
#####  TMUX CONFIG — ANDRÉS (i3/Arch)
#####  Prefix: Ctrl-s  (añade: echo 'stty -ixon' >> ~/.bashrc)
##### =========================

##### Rendimiento / compat
set -g assume-paste-time 1
set -g escape-time 0
set -g focus-events on
set -g history-limit 100000

##### Terminal / colores / shell
if-shell 'infocmp tmux-256color >/dev/null 2>&1' \
    'set -g default-terminal "tmux-256color"' \
    'set -g default-terminal "xterm-256color"'

set -ga terminal-overrides ",xterm-kitty:Tc,alacritty:Tc,xterm-256color:Tc"

if-shell 'command -v bash >/dev/null 2>&1' \
    'set -g default-shell "/usr/bin/bash"' \
    'set -g default-shell "/bin/sh"'


##### Prefix y envío
unbind C-b
set -g prefix C-s
bind C-s send-prefix

##### Índices y renumeración
set -g base-index 1
setw -g pane-base-index 1
set -g renumber-windows on

##### Ratón + Copy-mode (Vim) + clipboard auto
set -g mouse on
setw -g mode-keys vi
if-shell 'command -v wl-copy >/dev/null 2>&1' \
  'set -g @copy_cmd "wl-copy"' \
  'set -g @copy_cmd "xclip -selection clipboard"'

if -b 'test -z "#{@copy_cmd}"' "set -g @copy_cmd 'cat >/dev/null'"

unbind -T copy-mode-vi Enter
bind   -T copy-mode-vi Enter  send-keys -X copy-pipe-and-cancel "#{@copy_cmd}"
bind   -T copy-mode-vi y      send-keys -X copy-selection-and-cancel
bind   -T copy-mode-vi v      send-keys -X begin-selection
bind   -T copy-mode-vi V      send-keys -X select-line
bind   -T copy-mode-vi C-v    send-keys -X rectangle-selection
bind   -T copy-mode-vi Escape send-keys -X cancel

##### Navegación panes (sin choques con i3)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R
bind -r h select-pane -L
bind -r j select-pane -D
bind -r k select-pane -U
bind -r l select-pane -R
set -g repeat-time 300
set -g wrap-search on
bind -r Tab  select-pane -t :.+
bind -r BTab select-pane -t :.-
bind '{' swap-pane -U
bind '}' swap-pane -D
bind -n M-S-Left  resize-pane -L 5
bind -n M-S-Right resize-pane -R 5
bind -n M-S-Up    resize-pane -U 2
bind -n M-S-Down  resize-pane -D 2

##### Ventanas
bind -n M-Left  previous-window
bind -n M-Right next-window
bind -n C-PageDown next-window
bind -n C-PageUp   previous-window
bind a last-window

##### Splits en mismo cwd
bind '"' split-window -v -c "#{pane_current_path}"
bind %   split-window -h -c "#{pane_current_path}"
bind BSpace kill-pane -a
bind q   kill-pane
bind A select-pane -t :.+
bind Z resize-pane -Z \; display-message "🔎 Zoom: #{window_zoomed_flag}"

##### Sync panes
bind -n F10 setw synchronize-panes \; display "🔗 Sync: #{?pane_synchronized,on,off}"

##### Reload de config
unbind r
bind   r source-file ~/.tmux.conf \; display "🔄 Config reloaded!"


##### Plugins (TPM)
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'sainnhe/tmux-fzf'
set -g @plugin 'jaclu/tmux-menus'
set -g @plugin 'omerxx/tmux-sessionx'
set -g @plugin 'laktak/extrakto'
#set -g @plugin 'catppuccin/tmux#latest'
#set -g @plugin 'tmux-plugins/tmux-prefix-highlight'

##### Ajustes plugins
set -g @continuum-save-interval '15'
set -g @continuum-boot 'on'
set -g @continuum-restore 'on'
set -g @resurrect-capture-pane-contents 'on'
set -g @resurrect-strategy-nvim 'session'
set -g @vim_tmux_navigator_no_mappings 1
bind F run-shell "tmux-fzf"
bind m run-shell "tmux-menus"

# Sesiones
unbind s
bind s choose-tree -sw    # Prefix+s = selector nativo

# Prefix+Shift+S = SessionX si está; si no, fallback a choose-tree (evita 127)
unbind S
bind S if-shell 'test -x ~/.tmux/plugins/tmux-sessionx/scripts/sessionx.sh' \
  'run-shell -b "~/.tmux/plugins/tmux-sessionx/scripts/sessionx.sh"' \
  'choose-tree -sw'
bind f command-prompt -p 'Find:' 'find-window "%%"'

# Extrakto
set -g @extrakto_key 'x'
set -g @extrakto_split 'v'

# Yank → usa wl-copy/xclip autodetectado
set -g @copy_command "#{@copy_cmd}"

##### Cargar TPM
if-shell '[ -x "$HOME/.tmux/plugins/tpm/tpm" ]' \
    'run -b "$HOME/.tmux/plugins/tpm/tpm"' \
    'display-message "TPM no encontrado; salto carga de plugins"'

##### Tema base (Catppuccin), sin status
#set -g @catppuccin_flavor 'mocha'
#set -g @catppuccin_disable_status "yes"
set -g pane-border-style        "fg=brightblack"
set -g pane-active-border-style "fg=green"
set -g pane-border-status off 
set -g pane-border-format " #P: #{pane_current_command} — #{b:pane_current_path} "
set -g display-panes-time 5000
#set -g @catppuccin_window_status_format         " #[nobold]#I:#W "
#set -g @catppuccin_window_status_current_format " #[bold]#I:#W "
set -g @net_if "enp2s0"

##### Status bar (indicadores nativos + Git + CPU + MEM + NET)
set -g status on
set -g status-interval 5
set -g status-justify centre
set -g status-position bottom
set -g status-style "bg=#1e1e2e,fg=#cdd6f4"
set -g default-command "bash"

# Izquierda
set -g status-left-length 80
set -g status-left "\
#[fg=#89b4fa]#[bg=#89b4fa,fg=#1e1e2e] #(printf \"%.10s\" '#S') #[bg=#1e1e2e,fg=#89b4fa] \
#[fg=#94e2d5]#[bg=#94e2d5,fg=#1e1e2e] #(printf \"%.12s\" \"$USER@#{host_short}\") #[bg=#1e1e2e,fg=#94e2d5] \
#[fg=#f9e2af]#[bg=#f9e2af,fg=#1e1e2e] #(bash -lc '[ -x ~/.tmux/scripts/shorten_path.sh ] && ~/.tmux/scripts/shorten_path.sh \"#{pane_current_path}\"  || printf \"%.50s\" \"#{pane_current_path}\"') #[bg=#1e1e2e,fg=#f9e2af]"

# Derecha: PREFIX • COPY • GIT • CPU • MEM • NET • HORA (todo vía scripts robustos)
set -g status-right-length 200
set -g status-right "\
#[fg=#f38ba8]#[bg=#f38ba8,fg=#1e1e2e]  #{?client_prefix,⌨  PREFIX,} #[bg=#1e1e2e,fg=#f38ba8]\
 #[fg=#94e2d5]#[bg=#94e2d5,fg=#1e1e2e] #{?pane_in_mode,󰆏 COPY, } #[bg=#1e1e2e,fg=#94e2d5]\
 #[fg=#cba6f7]#[bg=#cba6f7,fg=#1e1e2e] #(sh -lc 'cd \"#{pane_current_path}\" 2>/dev/null && git rev-parse --abbrev-ref HEAD 2>/dev/null || true') #[bg=#1e1e2e,fg=#cba6f7]\
 #[fg=#000000]#[bg=#000000,fg=#777777] #(sh -lc '[ -x ~/.tmux/scripts/status_pill.sh ] && IF_OVERRIDE='"'#{@net_if}'"' ~/.tmux/scripts/status_pill.sh || printf \"\"') #[bg=#1e1e2e,fg=#1e1e2e]"


setw -g window-status-format         " #[nobold]#I:#W "
setw -g window-status-current-format " #[bold] #I:#W#{?window_zoomed_flag, ZOOM,} "
setw -g window-status-current-style  "bg=#585b70,fg=#f5e0dc"
setw -g window-status-style          "bg=#1e1e2e,fg=#a6adc8"
set -g set-titles off
set -g allow-rename off
setw -g automatic-rename off



